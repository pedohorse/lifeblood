

<!DOCTYPE html>


<html lang="en" data-theme="dark">

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Matrix Notifier &#8212; Lifeblood 1.0.0 documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "dark";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/custom.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/sphinx_highlight.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'nodes/stock/matrixnotifier';</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="prev" title="null" href="../core/null.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="dark">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
<div class="bd-header__inner bd-page-width">
  <label class="sidebar-toggle primary-toggle" for="__primary">
    <span class="fa-solid fa-bars"></span>
  </label>
  
  <div class="navbar-header-items__start">
    
      <div class="navbar-item">
  

<a class="navbar-brand logo" href="../../index.html">
  
  
  
  
    
    
    
    <img src="../../_static/lifeblood.svg" class="logo__image only-dark" alt="Logo image"/>
    <script>document.write(`<img src="../../_static/lifeblood.svg" class="logo__image only-light" alt="Logo image"/>`);</script>
  
  
</a></div>
    
  </div>
  
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item"><nav class="navbar-nav">
  <p class="sidebar-header-items__title"
     role="heading"
     aria-level="1"
     aria-label="Site Navigation">
    Site Navigation
  </p>
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../components/index.html">
                        Components
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../overview.html">
                        Overview of Lifeblood
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../concepts.html">
                        Main Concepts
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../installation.html">
                        Installation
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../usage.html">
                        How to Use
                      </a>
                    </li>
                
            <div class="nav-item dropdown">
                <button class="btn dropdown-toggle nav-item" type="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    More
                </button>
                <div class="dropdown-menu">
                    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../tutorials.html">
                        Tutorials
                      </a>
                    </li>
                

                    <li class="nav-item current active">
                      <a class="nav-link nav-internal" href="../../nodes.html">
                        Nodes
                      </a>
                    </li>
                
                </div>
            </div>
            
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          
<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
        </div>
      
      
        <div class="navbar-item">
<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">
<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
    </div>
  

  
    <label class="sidebar-toggle secondary-toggle" for="__secondary">
      <span class="fa-solid fa-outdent"></span>
    </label>
  
</div>

    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          <div class="navbar-item"><nav class="navbar-nav">
  <p class="sidebar-header-items__title"
     role="heading"
     aria-level="1"
     aria-label="Site Navigation">
    Site Navigation
  </p>
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../components/index.html">
                        Components
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../overview.html">
                        Overview of Lifeblood
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../concepts.html">
                        Main Concepts
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../installation.html">
                        Installation
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../usage.html">
                        How to Use
                      </a>
                    </li>
                
            <div class="nav-item dropdown">
                <button class="btn dropdown-toggle nav-item" type="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    More
                </button>
                <div class="dropdown-menu">
                    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../tutorials.html">
                        Tutorials
                      </a>
                    </li>
                

                    <li class="nav-item current active">
                      <a class="nav-link nav-internal" href="../../nodes.html">
                        Nodes
                      </a>
                    </li>
                
                </div>
            </div>
            
  </ul>
</nav></div>
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">
<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item"><nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><p aria-level="2" class="caption" role="heading"><span class="caption-text">Core Nodes:</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../core/null.html">null</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Stock Nodes:</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Matrix Notifier</a></li>
</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">



<nav aria-label="Breadcrumbs">
  <ul class="bd-breadcrumbs" role="navigation" aria-label="Breadcrumb">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="../../nodes.html" class="nav-link">Nodes</a></li>
    
    <li class="breadcrumb-item active" aria-current="page">Matrix Notifier</li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section id="matrix-notifier">
<span id="nodes-stock-matrixnotifier"></span><h1>Matrix Notifier<a class="headerlink" href="#matrix-notifier" title="Permalink to this heading">#</a></h1>
<p>Matrix notifier node allows you to send text and files to a given room of a given
matrix homeserver.</p>
<section id="parameters">
<h2>Parameters<a class="headerlink" href="#parameters" title="Permalink to this heading">#</a></h2>
<dl class="simple">
<dt>backend</dt><dd><p>what to use as a matrix client. By default - a simplest python client
is provided. It can only send unencrypted messages, which is good enough
for personal/local homeservers, but not good for public homeservers.
<code class="docutils literal notranslate"><span class="pre">matrix-commander</span></code> may be used as a client instead (also requires libolm).
see below</p>
</dd>
<dt>room</dt><dd><p>room id to connect to. should have form of !ksdojqlfjalskfj:matrix.smth</p>
</dd>
<dt>retries</dt><dd><p>how many times to retry if connection fails</p>
</dd>
<dt>fail task on notification sending error</dt><dd><p>if after all retries message is not set - set the task into error state.
if this is disabled - task will be considered done regardless of the
success or failure of the message sending</p>
</dd>
<dt>matrix server</dt><dd><p>matrix homeserver to use</p>
</dd>
<dt>message</dt><dd><p>message to send</p>
</dd>
<dt>attach a file</dt><dd><p>optionally, a file may be attached to the message. it can be image, video
or any other file. Be mindful if encryption is used when sending
sensitive files to public homeservers</p>
</dd>
</dl>
</section>
<section id="installing-matrix-commander-as-a-back-end">
<h2>Installing Matrix Commander as a back end<a class="headerlink" href="#installing-matrix-commander-as-a-back-end" title="Permalink to this heading">#</a></h2>
<p>By default matrix notifier comes with a simple client implementation that does <strong>NOT
implement</strong> E2E encryption.</p>
<p>This is is generally enough if a homeserver is local, but for public homeservers,
such as default matrix.org, it’s better to enable proper end-to-end encryption.</p>
<p>To enable end-to-end encryption you need to set up another backend, such as matrix-commander</p>
<section id="installing-matrix-commander">
<h3>Installing Matrix-Commander<a class="headerlink" href="#installing-matrix-commander" title="Permalink to this heading">#</a></h3>
<p>First of all, you need to ensure you have <a class="reference external" href="https://gitlab.matrix.org/matrix-org/olm">olm lib installed</a></p>
<p>on linux machines it’s available in packages repos under something like <code class="docutils literal notranslate"><span class="pre">libolm</span></code> name</p>
<p>matrix-commander is an open source command line <a class="reference external" href="https://github.com/8go/matrix-commander">matrix client</a></p>
<p>You can install it, keeping it completely isolated from your system libraries,
handy installation script is provided with lifeblood.</p>
<ol class="arabic">
<li><p>Open terminal, set it up so that <code class="docutils literal notranslate"><span class="pre">python</span></code> is available</p></li>
<li><p>Navigate into Lifeblood installation location <code class="docutils literal notranslate"><span class="pre">lifeblood/stock_nodes/matrixclient/data</span></code></p></li>
<li><p>There you should see script named <code class="docutils literal notranslate"><span class="pre">install_matrix_commander.py</span></code></p>
<p>This file will use currently available python to create a small virtual environment with matrix-commander in it.
All in the current directory</p>
</li>
<li><p>Run the script with <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">install_matrix_commander.py</span></code></p></li>
<li><p>If the script reports <code class="docutils literal notranslate"><span class="pre">success</span></code> - you should be good, even if there were some errors in the installation process’ log</p></li>
</ol>
<p>(keep your terminal open if you want to initialize matrix-commander right after installation)</p>
<p>After this you should be able to switch <code class="docutils literal notranslate"><span class="pre">matrixnotifier</span></code>’s <code class="docutils literal notranslate"><span class="pre">backend</span></code> parameter to <code class="docutils literal notranslate"><span class="pre">matrix-commander</span></code>
(also that will be the default value from now on for new nodes).</p>
<p>But before you can use matrix-commander - you need to initialize it and log in</p>
</section>
<section id="initializing-matrix-commander">
<h3>Initializing Matrix-Commander<a class="headerlink" href="#initializing-matrix-commander" title="Permalink to this heading">#</a></h3>
<p>To initialize matrix-commander you need to log in, and to join all the rooms to where your bot is supposed to report to.</p>
<ol class="arabic">
<li><dl class="simple">
<dt>From the terminal left open from the installation process first enter virtual environment</dt><dd><ul class="simple">
<li><p>on windows run <code class="docutils literal notranslate"><span class="pre">venv/bin/Activate</span></code></p></li>
<li><p>on any normal operating system do <code class="docutils literal notranslate"><span class="pre">.</span> <span class="pre">venv/bin/activate</span></code> or <code class="docutils literal notranslate"><span class="pre">source</span> <span class="pre">venv/bin/activate</span></code></p></li>
</ul>
</dd>
</dl>
</li>
<li><p>Now <code class="docutils literal notranslate"><span class="pre">matrix-commander</span></code> command should be available. If it’s not - something went wrong while activating vitrual env</p></li>
<li><dl class="simple">
<dt>Depending on your operating system:</dt><dd><ol class="loweralpha simple">
<li><p>Run <code class="docutils literal notranslate"><span class="pre">matrix-commander</span> <span class="pre">--login</span> <span class="pre">password</span></code> to start interactive login process using password</p></li>
<li><p>Run <code class="docutils literal notranslate"><span class="pre">matrix-commander</span> <span class="pre">--login</span> <span class="pre">sso</span></code> to start interactive login process using Single Sign-On</p></li>
</ol>
</dd>
</dl>
</li>
<li><p>matrix-commander should prompt you for homeserver, user, password and optionally default room. The room does not
matter too much as it will be overriden by the node, but if you have one room for notifications - why not add it here.</p></li>
<li><p>now you need to join any rooms you would want to send notifications to.</p>
<p>use <code class="docutils literal notranslate"><span class="pre">--room-join</span></code> command to join all rooms one by one, like: <code class="docutils literal notranslate"><span class="pre">matrix-commander</span> <span class="pre">--room-join</span> <span class="pre">!roomcode&#64;homeserver.smth</span></code></p>
</li>
<li><p>after this you will find file <code class="docutils literal notranslate"><span class="pre">credentials.json</span></code> and a directory <code class="docutils literal notranslate"><span class="pre">store</span></code> in your current directory -
these are authentication and e2e info needed to communicate to the server. We need to move it elsewhere</p></li>
<li><p>Find where you lifeblood config lives (by default
it’s your user dir), there navigate to <code class="docutils literal notranslate"><span class="pre">&lt;lifeblood</span> <span class="pre">config</span> <span class="pre">location&gt;/scheduler/nodes/matrixnotifier/matrixcommander</span></code>,
create missing directories.</p></li>
<li><dl class="simple">
<dt>There you need to create a directory based on a homeserver url you registered at.</dt><dd><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">://</span></code> turns into <code class="docutils literal notranslate"><span class="pre">..</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">/</span></code> thrns int <code class="docutils literal notranslate"><span class="pre">_</span></code></p></li>
</ul>
</dd>
</dl>
<p>For example, <code class="docutils literal notranslate"><span class="pre">https://matrix.org</span></code> turns into <code class="docutils literal notranslate"><span class="pre">https..matrix.org</span></code></p>
<p>therefore you need to create directory <code class="docutils literal notranslate"><span class="pre">&lt;lifeblood</span> <span class="pre">config</span> <span class="pre">location&gt;/scheduler/nodes/matrixnotifier/matrixcommander/https..matrix.org</span></code></p>
</li>
<li><p>Move <code class="docutils literal notranslate"><span class="pre">credentials.json</span></code> and <code class="docutils literal notranslate"><span class="pre">store</span></code> from before to this new directory</p></li>
<li><p>That’s it!</p>
<p>at this point you should have <code class="docutils literal notranslate"><span class="pre">credentials.json</span></code> and <code class="docutils literal notranslate"><span class="pre">store</span></code> in your</p>
<p><code class="docutils literal notranslate"><span class="pre">&lt;lifeblood</span> <span class="pre">config</span> <span class="pre">location&gt;/scheduler/nodes/matrixnotifier/matrixcommander/&lt;encoded_homeserver&gt;/</span></code></p>
</li>
</ol>
<p>Now matrix-commander is initialized and you are ready to start getting some notifications</p>
</section>
</section>
</section>


                </article>
              
              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="../core/null.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">null</p>
      </div>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#parameters">Parameters</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#installing-matrix-commander-as-a-back-end">Installing Matrix Commander as a back end</a><ul class="visible nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#installing-matrix-commander">Installing Matrix-Commander</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#initializing-matrix-commander">Initializing Matrix-Commander</a></li>
</ul>
</li>
</ul>
  </nav></div>

  <div class="sidebar-secondary-item">
  <div class="tocsection sourcelink">
    <a href="../../_sources/nodes/stock/matrixnotifier.rst.txt">
      <i class="fa-solid fa-file-lines"></i> Show Source
    </a>
  </div>
</div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">
  <p class="copyright">
    
      © Copyright 10132 BC - 2029 AD, XAPKOHHEH.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">
  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 5.3.0.
    <br/>
  </p>
</div>
      
    </div>
  
  
    <div class="footer-items__end">
      
        <div class="footer-item"><p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.13.3.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>