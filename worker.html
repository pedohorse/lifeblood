<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Lifeblood Worker &mdash; Lifeblood 1.0.0 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Lifeblood Viewer" href="viewer/viewer.html" />
    <link rel="prev" title="Scheduler Config" href="scheduler/scheduler_configs.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> Lifeblood
          </a>
              <div class="version">
                1.0.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="overview.html">Overview of Lifeblood</a></li>
<li class="toctree-l1"><a class="reference internal" href="usage.html">How to Use</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorials.html">Tutorials</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Components:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="scheduler/scheduler.html">Lifeblood Scheduler</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Lifeblood Worker</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pre-requisites">Pre-requisites</a></li>
<li class="toctree-l2"><a class="reference internal" href="#launching">Launching</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#logging">Logging</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="viewer/viewer.html">Lifeblood Viewer</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Lifeblood</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Lifeblood Worker</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/worker.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="lifeblood-worker">
<span id="worker"></span><h1>Lifeblood Worker<a class="headerlink" href="#lifeblood-worker" title="Permalink to this heading"></a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#overview" id="id1">Overview</a></p></li>
<li><p><a class="reference internal" href="#pre-requisites" id="id2">Pre-requisites</a></p></li>
<li><p><a class="reference internal" href="#launching" id="id3">Launching</a></p>
<ul>
<li><p><a class="reference internal" href="#logging" id="id4">Logging</a></p></li>
</ul>
</li>
</ul>
</div>
<section id="overview">
<h2><a class="toc-backref" href="#id1">Overview</a><a class="headerlink" href="#overview" title="Permalink to this heading"></a></h2>
<p>Worker is the part of Lifeblood that is responsible for launching things as ordered by scheduler. A task may (or may not)
create a payload that needs to be computed. For example: run simulation caching, render a frame, generate procedural
geometry, etc.</p>
<p>These payloads are not run by Scheduler directly, instead the Scheduler assigns this payload to one of free workers.
The worker will do the job and report back to the Scheduler with results (or error)</p>
<div class="line-block">
<div class="line">You would have a single scheduler and multiple workers ran across local network.</div>
<div class="line">Worker knows about computational resources available on the machine it runs on, and reports that to scheduler.</div>
</div>
<p>Multiple workers may be launched on the same machine, they should be able to agree with each other on how to share
resources among each other</p>
<p>Workers can be started on the same machine with scheduler, BUT you should be careful to leave enough resources for
scheduler to work. If machine runs out of memory - scheduler will have problems working and may crash
or be killed by the system.</p>
</section>
<section id="pre-requisites">
<h2><a class="toc-backref" href="#id2">Pre-requisites</a><a class="headerlink" href="#pre-requisites" title="Permalink to this heading"></a></h2>
<p>currently worker requires:</p>
<ul class="simple">
<li><p>existing temporary directory, shared between all worker instances (<span class="xref std std-ref">scratch location</span>)</p></li>
<li><p>all worker instances on the same machine must share the same network namespace</p></li>
</ul>
</section>
<section id="launching">
<h2><a class="toc-backref" href="#id3">Launching</a><a class="headerlink" href="#launching" title="Permalink to this heading"></a></h2>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">lifeblood</span> <span class="pre">worker</span></code></p>
</div></blockquote>
<p>here you would also supply component-specific command line arguments, for example</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">lifeblood</span> <span class="pre">--loglevel</span> <span class="pre">DEBUG</span> <span class="pre">worker</span></code></p>
</div></blockquote>
<p>See all options using built-in help:</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">lifeblood</span> <span class="pre">worker</span> <span class="pre">--help</span></code></p>
</div></blockquote>
<p>It’s important to understand: one worker can launch only one payload process at one time,
there is no concept of slots. Instead, multiple workers running locally negociate with each other to share resources
properly.</p>
<p>So all locally running workers will inform each other about the amount of resources that the task they
currently run requested, sharing all machine resources without overspending.</p>
<p>On a machine with a lot of CPU cores for example it makes sense to have more than one workers running
to use resources efficiently, and it can be tedious to manually launch all workers.</p>
<p>For that reason worker <a class="reference internal" href="usage.html#usage-pools"><span class="std std-ref">pools exist</span></a>. Generally it’s a bigger concept, in this case we need a simplest worker pool
implementation - simple local worker pool.</p>
<p>This pool operates according to the following logic:</p>
<ul class="simple">
<li><p>if there is no free workers and we are not at worker limit - launch a worker</p></li>
<li><p>a worker that finishes a task terminates</p></li>
</ul>
<p>well, that’s it, not much complicated logic in there, but it’s more powerful than a worker with constant number of slots:</p>
<ul class="simple">
<li><p>pool launches a worker (let’s call it worker1), it advertises to scheduler all of it’s (for example) 32 cores and 64 GBs of ram</p></li>
<li><p>scheduler assigns worker1 a task that requires 8 cpu cores adn 16GB ram</p></li>
<li><p>there’s no free workers now, so pool launches another worker (worker2). worker2 will communicate with worker1
and learn about the task it’s executing, so worker2 will only advertise 24 cores and 48 GBs of ram to the scheduler</p></li>
<li><p>scheduler assigns worker2 a task that requires 20 cores and 40GB of ram</p></li>
<li><p>there’s no free workers now, so pool launches another worker (worker3). worker3 will communicate with worker1
and worker2 and set it’s resources to 4 cores and 8 GBs of ram</p></li>
<li><p>now worker1 finishes task and terminates, worker2 and worker3 are informed, and both of them adjust the resources
advertised to scheduler to 12 cores and 24 GB of ram, though worker2 is still working on it’s task</p></li>
<li><p>worker2 finishes task and terminates, worker3 is informed, so it adjusts resources advertised to scheduler to full
machine’s resources: 32 cores and 64 GBs of ram.</p></li>
</ul>
<p>and this can get as granular as resources allow. That’s why always make sure to set up non zero resources usage for your tasks
and limit maximum workers that pool can spawn to some sane and safe amount.</p>
<section id="logging">
<h3><a class="toc-backref" href="#id4">Logging</a><a class="headerlink" href="#logging" title="Permalink to this heading"></a></h3>
<div class="line-block">
<div class="line">All Lifeblood components log to stdout, as well as to a log file.</div>
<div class="line">Log files location is:</div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">/home/&lt;username&gt;/.local/share/lifeblood/log</span></code> (or <code class="docutils literal notranslate"><span class="pre">$XDG_DATA_HOME</span></code> if defined) (linux)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">C:\Users\&lt;username&gt;\AppData\Local\lifeblood\log</span></code> (based on <code class="docutils literal notranslate"><span class="pre">%LOCALAPPDATA%</span></code>) (windows)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">/Users/&lt;username&gt;/Library/Application</span> <span class="pre">Support/lifeblood/log</span></code> (mac)</p></li>
</ul>
<p>By default all components of Lifeblood are set to log only “important” messages (like warnings and errors),
but to figure out what’s happening sometimes you would need a bit more information.</p>
<div class="line-block">
<div class="line">All of Lifeblood’s components can accept <code class="docutils literal notranslate"><span class="pre">--loglevel</span></code> parameter before command to specify minimum log level to, well, log.</div>
<div class="line">for example <code class="docutils literal notranslate"><span class="pre">lifeblood</span> <span class="pre">scheduler</span> <span class="pre">--loglevel</span> <span class="pre">DEBUG</span></code> will set default log level to DEBUG and you will see all the
crap printed out into stdout</div>
</div>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="scheduler/scheduler_configs.html" class="btn btn-neutral float-left" title="Scheduler Config" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="viewer/viewer.html" class="btn btn-neutral float-right" title="Lifeblood Viewer" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 10132 BC - 2029 AD, XAPKOHHEH.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>